<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>Read Me A Story - AI Historie Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <header>
        <div class="user-status">
            {% if current_user.is_authenticated %}
                <a href="{{ url_for('logout') }}" class="button-logout utility-button">Log ud</a>
            {% else %}
                <a href="{{ url_for('google_login') }}" class="button-login utility-button">Login med Google</a>
            {% endif %}
        </div>
        <h1>Read Me A Story (BETA)</h1>
        <p>Sidst opdateret: 2. maj 2025</p>
        <p>Skab jeres helt egen, unikke historier med jeres børn!</p>
    </header>

    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages-container">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">
                            {{ message }}
                            {# Disclaimer KUN til logout beskeden ('info' kategori) #}
                            {% if category == 'info' and 'logget ud' in message %}
                                <p class="flash-disclaimer">(Bemærk: Dit navn kan stadig være synligt i toppen indtil næste sideindlæsning.)</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <section id="generator">
            <h2>Byg jeres historie</h2>
             <p>(Det er ikke nødvendigt at udfylde alle felterne.)</p>

            <div class="input-category">
                <label>Hvem skal historien læses for?</label>
                <div id="listener-container">
                    <div class="listener-group">
                        <div class="input-pair">
                           <label for="listener-name-1" class="sr-only">Navn</label>
                            <input type="text" name="listener_name_single" id="listener-name-1" placeholder="Barnets Navn">
                        </div>
                        <div class="input-pair">
                           <label for="listener-age-1" class="sr-only">Alder</label>
                            <input type="text" name="listener_age_single" id="listener-age-1" placeholder="Alder (f.eks. 5)">
                        </div>
                         <button type="button" class="remove-button initial-remove-button" aria-hidden="true">-</button>
                    </div>
                </div>
                <button type="button" id="add-listener-button" class="add-button">+ Tilføj barn</button>
            </div>

            <div class="input-category">
                <label>Hvem skal være hovedperson(er)?</label>
                <div id="karakter-container">
                    <div class="character-group">
                         <div class="input-pair">
                            <label for="karakter-desc-1" class="sr-only">Beskrivelse</label>
                            <input type="text" name="karakter_desc" id="karakter-desc-1" placeholder="Beskrivelse (f.eks. en modig bi)">
                         </div>
                         <div class="input-pair">
                            <label for="karakter-navn-1" class="sr-only">Navn</label>
                            <input type="text" name="karakter_navn" id="karakter-navn-1" placeholder="Navn (valgfrit)">
                         </div>
                         <button type="button" class="remove-button initial-remove-button" aria-hidden="true">-</button>
                    </div>
                </div>
                <button type="button" id="add-karakter-button" class="add-button">+ Tilføj karakter</button>
            </div>

            <div class="input-category">
                <label>Hvor skal historien foregå?</label>
                <div id="sted-container">
                     <div class="input-group">
                        <input type="text" name="sted" placeholder="f.eks. i en kagebutik, på månen">
                        <button type="button" class="remove-button initial-remove-button" aria-hidden="true">-</button>
                     </div>
                </div>
                <button type="button" class="add-button" data-container="sted-container" data-placeholder="f.eks. under en stor svamp" data-name="sted">+ Tilføj sted</button>
            </div>

            <div class="input-category">
                <label>Ting, hændelser eller morale?</label>
                <div id="plot-container">
                    <div class="input-group">
                        <input type="text" name="plot" placeholder="f.eks. en magisk fjer, 'at dele er godt'">
                        <button type="button" class="remove-button initial-remove-button" aria-hidden="true">-</button>
                    </div>
                </div>
                 <button type="button" class="add-button" data-container="plot-container" data-placeholder="f.eks. en hemmelig dør, 'ærlighed varer længst'" data-name="plot">+ Tilføj ting/morale</button>
            </div>

             <div class="input-category">
                <label for="negative-prompt-input">Ting der IKKE skal med i historien:</label>
                <div class="input-group">
                     <textarea id="negative-prompt-input" name="negative_prompt" rows="3" placeholder="f.eks. 'ingen edderkopper', 'undgå monstre', 'ikke noget om at falde' (adskil med komma eller linjeskift)"></textarea>
                     </div>
            </div>

            <div class="input-category">
                <label for="laengde-select">Vælg historie længde:</label>
                <select name="laengde" id="laengde-select">
                    <option value="kort" selected>Kort</option>
                    <option value="mellem">Mellem</option>
                    <option value="lang">Lang</option>
                </select>
            </div>

            <div class="input-category">
                <label for="mood-select">Vælg stemning:</label>
                <select name="mood" id="mood-select">
                    <option value="neutral" selected>Neutral / Blandet</option>
                    <option value="sød">Sød</option>
                    <option value="sjov">Sjov / Humoristisk</option>
                    <option value="eventyr">Eventyrlig</option>
                    <option value="spændende">Spændende</option>
                    <option value="rolig">Rolig / Afslappende</option>
                    <option value="mystisk">Mystisk</option>
                    <option value="hverdagsdrama">Hverdagsdrama (små konflikter)</option>
                    <option value="uhyggelig">Uhyggelig</option>
                </select>
            </div>

            <div class="input-category checkbox-group">
                <input type="checkbox" id="interactive-checkbox" name="interactive">
                <label for="interactive-checkbox">Gør historien til et inddragende eventyr (med valgmuligheder)?</label>
            </div>

            <div class="generator-actions">
                 <button type="button" id="autofill-button" class="utility-button">Autoudfyld</button>
                 <button type="button"
                        id="read-aloud-button"
                        class="utility-button tts-button {% if not current_user.is_authenticated %}disabled-button{% endif %}"
                        {% if not current_user.is_authenticated %}disabled title="Login for at aktivere funktionen"{% endif %}>
                    Læs Historien Højt
                </button>
                 </div> <button id="generate-button">Skab Historie</button>

        </section> <section id="historie-output">

            <div class="historie-header-controls">
                <h2>Jeres historie</h2>
                <div class="audio-controls-container">
                    <div id="audio-loading" class="hidden">Genererer lyd, vent venligst... <span class="spinner"></span></div>
                    <div id="audio-error" class="feedback-status error"></div> <div class="login-prompt hidden" id="login-prompt-audio">
                         <em>Du skal være <a href="{{ url_for('google_login') }}">logget ind</a> for at få læst historien højt.</em>
                    </div>
                    <audio id="audio-player" controls class="audio-player-style hidden">
                        Din browser understøtter ikke lyd-elementet.
                    </audio>
                </div>
            </div>

            <div id="story-display">
                 </div>

            <button id="reset-button" class="utility-button" style="display: none;">Prøv Igen</button>

        </section> <section id="feedback-section">
             <button type="button" id="toggle-feedback-button" class="utility-button">Giv Feedback / Skjul Feedback</button>
             <div id="feedback-embed-container" class="hidden">
                 <iframe src="https://docs.google.com/forms/d/e/1FAIpQLScNfIyz-0hNlgfKAkJo-ioT99LYqjBRo8tO5HvzoXfjaY0HvA/viewform?embedded=true"
                    width="100%"
                    height="500"
                    frameborder="0"
                    marginheight="0"
                    marginwidth="0">Indlæser…</iframe>
             </div>
        </section>

    </main>

    <footer>
        <hr>
        <p>© Read Me A Story 2025 - Historier skabt med AI.</p>
        <p><i>Forældreopsyn anbefales altid under læsning. ;)</i></p>
    </footer>

    <script src="{{ url_for('static', filename='script.js') }}"></script>

</body>
</html>